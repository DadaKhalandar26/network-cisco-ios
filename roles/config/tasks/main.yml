---
- name: Configure login banner using ios_banner
  cisco.ios.ios_banner:
    banner: login
    text: "{{ lookup('template', /templates/banner.j2') }}"
    state: present
    
- name: Set hostname
  ios_config:
    lines:
      - hostname {{ inventory_hostname }}

- name: Configure domain name
  ios_config:
    lines:
      - ip domain-name {{ domain_name }}

# - name: Render intended config
#   ansible.builtin.template:        
#     src: base_config.j2
#     dest: "/tmp/{{ inventory_hostname }}-intended.cfg"

# - name: Get running config
#   cisco.ios.ios_command:           
#     commands: show running-config
#   register: backup_running_cfg      

# - name: Save running config to file
#   ansible.builtin.copy:            
#     content: "{{ backup_running_cfg.stdout[0] }}"
#     dest: "/tmp/{{ inventory_hostname }}-running.cfg"
#     mode: '0644'

# - name: Compare running vs intended
#   ansible.builtin.command:
#     cmd: diff /tmp/{{ inventory_hostname }}-intended.cfg /tmp/{{ inventory_hostname }}-running.cfg
#   register: cfg_diff
#   changed_when: cfg_diff.rc != 0

# - name: Fail if drift detected
#   ansible.builtin.fail:           
#     msg: "Compliance drift on {{ inventory_hostname }}: {{ cfg_diff.diff }}"
#   when: cfg_diff.changed
